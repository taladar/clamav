Description: Fix for out-of-bounds read in ARJ parser
 Fix for an out-of-bounds read in the ARJ parser accidentally introduced
 when adding text normalization and bound checking when parsing filename
 and comment fields from file headers.
Origin: https://github.com/Cisco-Talos/clamav-devel/commit/6c4569edea524a65c409d256b60ee607162ce468
Author: Micah Snyder <micasnyd@cisco.com>
Author: Utkarsh Gupta <utkarsh@debian.org>
Last-Update: 2020-05-19

--- a/libclamav/unarj.c
+++ b/libclamav/unarj.c
@@ -835,13 +835,11 @@
 	uint16_t header_size, count;
 	arj_main_hdr_t main_hdr;
 	const char *filename, *comment;
-	off_t header_offset;
 
 	if (fmap_readn(metadata->map, &header_size, metadata->offset, 2) != 2)
 	    return FALSE;
 
 	metadata->offset += 2;
-	header_offset = metadata->offset;
 	header_size = le16_to_host(header_size);
 	cli_dbgmsg("Header Size: %d\n", header_size);
 	if (header_size == 0) {
@@ -873,14 +871,14 @@
 	    metadata->offset += main_hdr.first_hdr_size - 30;
 	}
 
-	filename = fmap_need_offstr(metadata->map, metadata->offset, header_size);
+	filename = fmap_need_offstr(metadata->map, metadata->offset, header_size + 1);
 	if (!filename) {
         cli_dbgmsg("UNARJ: Unable to allocate memory for filename\n");
 		return FALSE;
     }
 	metadata->offset += strlen(filename) + 1;
 
-	comment = fmap_need_offstr(metadata->map, metadata->offset, header_size);
+	comment = fmap_need_offstr(metadata->map, metadata->offset, header_size + 1);
 	if (!comment) {
         cli_dbgmsg("UNARJ: Unable to allocate memory for comment\n");
 		return FALSE;
@@ -957,14 +955,14 @@
 	    metadata->offset += file_hdr.first_hdr_size - 30;
 	}
 
-	filename = fmap_need_offstr(metadata->map, metadata->offset, header_size);
+	filename = fmap_need_offstr(metadata->map, metadata->offset, header_size + 1);
 	if (!filename) {
         cli_dbgmsg("UNARJ: Unable to allocate memory for filename\n");
 		return FALSE;
     }
 	metadata->offset += strlen(filename) + 1;
 
-	comment = fmap_need_offstr(metadata->map, metadata->offset, header_size);
+	comment = fmap_need_offstr(metadata->map, metadata->offset, header_size + 1);
 	if (!comment) {
         cli_dbgmsg("UNARJ: Unable to allocate memory for comment\n");
 		return FALSE;
